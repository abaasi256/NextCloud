{
    # Production: Use real email for Let's Encrypt
    # email admin@example.com
}

cloud.example.com {
    # 1. Security Headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options nosniff
        X-Frame-Options SAMEORIGIN
        Referrer-Policy no-referrer-when-downgrade
        Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=(), interest-cohort=()"
    }

    # 2. Main Application Proxy (FastCGI)
    # Serves dynamic content via FPM
    php_fastcgi app:9000

    # 3. Proxy-Only Mode
    # Caddy does not directly serve Nextcloud files
    # All requests including static assets are handled by FastCGI

    # 4. Access Control (Hardening)
    # Block internal usage files and config
    @forbidden {
        path /build/* /tests/* /config/* /lib/* /3rdparty/* /templates/* /data/*
        path /.* /autotest /occ /issue /indie /db_ /console
    }
    respond @forbidden 404

    # 5. Service Discovery Redirects
    # Required for CalDAV/CardDAV client auto-discovery
    redir /.well-known/carddav /remote.php/dav 301
    redir /.well-known/caldav /remote.php/dav 301
}
